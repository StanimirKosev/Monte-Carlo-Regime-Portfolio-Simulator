graph TD
    A[monte-carlo/] --> B[backend/]
    A --> C[frontend/]
    A --> D[tasks/]
    A --> E[docs/]
    A --> F[screenshots/]

    subgraph Backend
        B --> G[core/]
        B --> H[simulation/]
        B --> I[optimization/]
        B --> J[app.py - FastAPI main]
        B --> K[Dockerfile]
        B --> L[pyproject.toml - Poetry]

        subgraph Core
            G --> G1[__init__.py]
            G --> G2[logging_config.py]
            G --> G3[portfolio.py]
            G --> G4[utils.py]
            G --> G5[api/]
            
            G5 --> G5a[api_utils.py]
            G5 --> G5b[models.py]
            G5 --> G5c[routes.py]
        end

        subgraph Simulation
            H --> H1[engine/]
            H --> H2[api/]
            H --> H3[charts/]
            H --> H4[tests/]
            H --> H5[main.py]
            
            H1 --> H1a[monte_carlo.py]
            H1 --> H1b[portfolio.py]
            H1 --> H1c[utils.py]
            H1 --> H1d[visualization.py]
            
            H2 --> H2a[api_utils.py]
            H2 --> H2b[models.py]
            H2 --> H2c[routes.py]
            
            H3 --> H3a[historical/]
            H3 --> H3b[fiat_debasement/]
            H3 --> H3c[geopolitical_crisis/]
            H3 --> H3d[custom/]
            
            H4 --> H4a[test_api.py]
            H4 --> H4b[test_monte_carlo.py]
        end

        subgraph Optimization
            I --> I1[engine/]
            I --> I2[api/]
            I --> I3[tests/]
            
            I1 --> I1a[markowitz.py]
            
            I2 --> I2a[api_utils.py]
            I2 --> I2b[models.py]
            I2 --> I2c[routes.py]
            
            I3 --> I3a[test_api.py]
            I3 --> I3b[test_markowitz.py]
        end
    end

    subgraph Frontend
        C --> M[src/]
        C --> N[public/]
        C --> O[package.json]
        C --> P[Dockerfile]
        
        M --> M1[components/]
        M --> M2[pages/]
        M --> M3[lib/]
        M --> M4[store/]
        M --> M5[types/]
        M --> M6[App.tsx]
        
        M1 --> M1a[UI components]
        M1 --> M1b[Charts & visualizations]
        M1 --> M1c[EfficientFrontierChart.tsx]
        M1 --> M1d[PortfolioCarousel.tsx]
        M2 --> M2a[CustomPortfolioForm.tsx]
        M3 --> M3a[api.ts]
        M3 --> M3b[portfolioUtils.ts]
        M4 --> M4a[regimeStore.ts]
        M4 --> M4b[customPortfolioStore.ts]
        M5 --> M5a[portfolio.ts]
        M5 --> M5b[regime.ts]
    end

    subgraph Tasks
        D --> D1[simulation-backend.md]
        D --> D2[simulation-frontend.md]
        D --> D3[optimization-backend.md]
        D --> D4[optimization-frontend.md]
    end

    %% Data/control flows
    M3a -- REST API --> J
    M3a -- WebSocket --> I2c
    J -- serves static --> H3
    J -- imports --> G5c
    J -- imports --> H2c
    J -- imports --> I2c
    G5a -- imports --> G4
    H2a -- imports --> H1a
    I2a -- imports --> I1a
    I2a -- imports --> G5a
    H1d -- saves to --> H3
    H1c -- uses --> G2
    I2c -- WebSocket progress --> M1c

    %% WebSocket connection highlight
    classDef websocket fill:#ff9999,stroke:#333,stroke-width:2px
    class I2c websocket